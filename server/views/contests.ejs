<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">

    <style type="text/css">
        #mainPopup {
            padding: 10px;
            height: 400px;
            width: 700px;
        }
        h1 {
            font-size: 2em;
        }
        table, th, td {
        border:1px solid black;
        }
    </style>
    <title>CF Extension</title>
</head>

<body>
    <div id="mainPopup">
        <h1 style="text-align: center;"><a href="https://codeforces.com/contests">Upcoming Contests</a></h1>
        <table class="table">
            <thead>
              <tr>
                <th scope="col">#</th>
                <th scope="col">Contest Id</th>
                <th scope="col">Contest Name</th>
                <th scope="col">Start Date</th>
                <th scope="col">Start Time</th>
                <th scope="col">Link</th>
              </tr>
            </thead>
            <tbody id = "contestList">
              
            </tbody>
          </table>
    </div>
</body>

<script>let months = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
    let url = 'https://codeforces.com/api/contest.list'
    let i = 0;
    fetch(url)
        .then(res => res.json())
        .then(data => //console.log(data.result[0].startTimeSeconds*1000, Date.now())
            data.result.forEach(el => {
                if (el.startTimeSeconds * 1000 > Date.now()) {
                    i++;
                    let unix_timestamp = el.startTimeSeconds
                    let date = new Date(unix_timestamp * 1000);
                    let year = date.getFullYear();
                    let month = months[date.getMonth()];
                    let day = date.getDate();
                    let hours = date.getHours();
                    let minutes = "0" + date.getMinutes();
                    let seconds = "0" + date.getSeconds();
                    let formattedTime = hours + ':' + minutes.substr(-2) + ':' + seconds.substr(-2);
                    let formattedDate =  month + ' '+ day + ', ' + year;
                    let toAdd =`<tr>
                    <th scope="row">${i}</th>
                    <td>${el.id}</td>
                    <td>${el.name}</td>
                    <td>${formattedDate}</td>
                    <td>${formattedTime}</td>
                    <td><a href = "https://codeforces.com/contests/${el.id}" >Register</a></td>
                  </tr>`
                    let contest = `<li>${el.id}:${el.name} at ${formattedTime}</li>`;
                    document.getElementById("contestList").innerHTML += toAdd;
            }
            })
        )
        .catch(error => console.log('ERROR'))</script>
</html>
